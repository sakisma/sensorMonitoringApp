<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Heatmap</title>
    <script src="https://unpkg.com/@antv/g2/dist/g2.min.js"></script>
</head>
<body>
    <div id="heatmap-container" style="width: 100%; height: 100%;"></div>

    <script>
        let chart;

        // Function to initialize the heatmap
        function initHeatmap() {
            chart = new G2.Chart({
                container: 'heatmap-container',
                width: 900,
                height: 340,
            });

            // Render an empty chart initially
            chart.render();
        }

        // Function to update the heatmap with new data
        function updateHeatmapData(passData) {
            console.log("Data received:", passData);
            let data;
            try {
                data = JSON.parse(passData);
            } catch (error) {
                console.error("Error parsing JSON data:", error);
                return;
            }

            if (!chart) {
                initHeatmap();
            }

            // Clear previous data
            chart.clear();

            // Add new data and render the heatmap
            chart
                .cell()
                .data(data)
                .scale('color', { palette: 'gnBu' })
                .encode('x', (d) => new Date(d.date).getUTCDate())
                .encode('y', (d) => d.monthYear)
                .encode('color', 'temperature') // Color based on temperature
                .style('stroke', '#000') // Cell border color
                .style('inset', 0.5) // Cell padding
                .animate('enter', { type: 'fadeIn' }); // Animation

            chart.render();
        }

        // Initialize the heatmap when the page loads
        initHeatmap();
    </script>
</body>
</html>